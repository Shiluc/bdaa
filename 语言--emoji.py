import pandas as pd
import numpy as np
from sklearn.feature_extraction.text import CountVectorizer
from sklearn.naive_bayes import MultinomialNB
from sklearn.pipeline import Pipeline

# --- 1. 扩充后的“大数据”集 ---
data = {
    'text': [
        # === 😄 开心/庆祝 ===
        "今天天气真好，超级开心", "我通过了考试，太棒了", "很高兴见到你", "爱死这个礼物了",
        "运气真好", "哈哈哈哈笑死我了", "今天是个好日子", "感觉人生到达了巅峰",
        "中奖啦", "这种感觉太美妙了", "笑得肚子疼", "不仅顺利还在预期之上",
        "这就是我想要的", "完美的一天", "好运爆棚", "我要开香槟庆祝",

        # === 😭 难过/失望 ===
        "我的电脑坏了，好烦", "今天很倒霉", "我很难过，想哭", "糟糕透了",
        "我不小心把手机摔了", "心情不好", "失恋了", "为什么受伤的总是我",
        "我想一个人静静", "感觉身体被掏空", "太令人失望了", "眼泪止不住",
        "错过了一个亿", "心里空落落的", "这种结果我不接受", "蓝瘦香菇",

        # === 🍔 吃货/美食 ===
        "肚子好饿，想吃大餐", "中午吃什么呢", "这个披萨太好吃了", "我想喝奶茶",
        "好想吃火锅啊", "美味佳肴", "干饭人干饭魂", "深夜放毒",
        "烧烤配啤酒", "这碗面真香", "我要减肥但是忍不住", "吃饱了才有力气干活",
        "想吃炸鸡", "麻辣烫", "口水直流", "味蕾爆炸",

        # === 💻 工作/学习 ===
        "必须努力工作", "正在写代码", "今晚要加班了", "正在开会中",
        "又要写报告了", "学习使我快乐", "这个Bug改不完", "头发都要掉光了",
        "正在赶Deadline", "PPT还没做完", "马上要考试了", "正在复习",
        "很多邮件要回", "程序员的痛苦", "正在根据客户需求修改", "天天996",

        # === 😡 愤怒/生气 (新增) ===
        "气死我了", "这人怎么这样", "烦死了", "滚蛋",
        "我忍你很久了", "不可理喻", "真是个白痴", "能不能闭嘴",
        "由于愤怒全身发抖", "不想和你说话", "太过分了", "我要投诉",
        "完全是浪费时间", "这种态度让人火大", "气炸了", "简直是胡扯",

        # === ❤️ 爱意/喜欢 (新增) ===
        "我爱你", "好想你", "你是我的唯一", "喜欢和你在一起",
        "比心", "你今天真好看", "想给你一个拥抱", "永远在一起",
        "情人节快乐", "我的心里只有你", "太甜了", "撒狗粮",
        "这是爱的感觉", "只要有你在就好", "宝贝晚安", "心动的感觉"
    ],
    # 对应的标签（必须和 text 的行数一一对应）
    'emoji': [
        # 😄 开心 (16条)
        "😄", "😄", "😄", "😄", "😄", "😄", "😄", "😄", "😄", "😄", "😄", "😄", "😄", "😄", "😄", "😄",
        # 😭 难过 (16条)
        "😭", "😭", "😭", "😭", "😭", "😭", "😭", "😭", "😭", "😭", "😭", "😭", "😭", "😭", "😭", "😭",
        # 🍔 吃货 (16条)
        "🍔", "🍔", "🍔", "🍔", "🍔", "🍔", "🍔", "🍔", "🍔", "🍔", "🍔", "🍔", "🍔", "🍔", "🍔", "🍔",
        # 💻 工作 (16条)
        "💻", "💻", "💻", "💻", "💻", "💻", "💻", "💻", "💻", "💻", "💻", "💻", "💻", "💻", "💻", "💻",
        # 😡 愤怒 (16条)
        "😡", "😡", "😡", "😡", "😡", "😡", "😡", "😡", "😡", "😡", "😡", "😡", "😡", "😡", "😡", "😡",
        # ❤️ 爱意 (16条)
        "❤️", "❤️", "❤️", "❤️", "❤️", "❤️", "❤️", "❤️", "❤️", "❤️", "❤️", "❤️", "❤️", "❤️", "❤️", "❤️"
    ]
}

df = pd.DataFrame(data)

# --- 2. 训练配置 (保持按字切分) ---
model_pipeline = Pipeline([
    ('vectorizer', CountVectorizer(analyzer='char', ngram_range=(1, 2))),
    ('classifier', MultinomialNB())
])

print(f"📚 正在使用 {len(df)} 条数据训练模型...")
model_pipeline.fit(df['text'], df['emoji'])
print("✅ 训练完成！支持情感：😄 😭 🍔 💻 😡 ❤️\n")


# --- 3. 智能预测 ---
def predict_emoji(text):
    proba = model_pipeline.predict_proba([text])[0]
    max_proba = np.max(proba)
    prediction = model_pipeline.predict([text])[0]

    # 稍微提高一点门槛，过滤完全不相关的输入
    if max_proba < 0.20:
        return "🤔 (没看懂)"

    return prediction


# --- 4. 自动测试新场景 ---
test_sentences = [
    "这也太气人了吧",  # 应该识别出“气” -> 😡
    "宝贝我想死你了",  # 应该识别出“宝贝/想” -> ❤️
    "今晚去撸串",  # 应该识别出“串/吃” -> 🍔
    "又要改需求头大",  # 应该识别出“改/头” -> 💻
    "我也太幸运了吧",  # 应该识别出“幸运” -> 😄
    "真的很受伤",  # 应该识别出“受伤” -> 😭
]

print("--- 🎯 新数据测试结果 ---")
for sentence in test_sentences:
    emoji = predict_emoji(sentence)
    print(f"输入: {sentence:<15} -> 预测: {emoji}")

# --- 5. 交互模式 ---
print("\n--- 🎤 轮到你了 (输入 'q' 退出) ---")
while True:
    try:
        user_input = input("请输入: ")
        if user_input.lower() == 'q':
            break
        if not user_input.strip():
            continue
        print(f"AI 回复: {predict_emoji(user_input)}\n")
    except KeyboardInterrupt:
        break